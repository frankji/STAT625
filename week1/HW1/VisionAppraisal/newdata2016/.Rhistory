myinfo[24]<-myreg('<td>Garage</td>',x,'\\S+',numonly = TRUE, nextline = 1)
extab<-catchtab(x,'Extra Features')
if(class(extab)=='data.frame'){
myinfo[19]<- sum(money2num(extab[,grep('[Vv][Aa][Ll][Uu][Ee]', colnames(extab))]))
}
saletab<-catchtab(x,'Ownership History')
if(class(saletab)=='data.frame'){
myinfo[25:39]<-getsale(saletab)
}
myinfo
grep('1',c(1,2,3))
grep('2',c(1,2,3))
grep('',c(1,2,3))
grep('7',c(1,2,3))
length(grep('7',c(1,2,3)))
catchtab<-function(x, tabname){
ln<-grep('^\\s+<table.*>', x)
cap<-which(trimws(x[ln+2])==tabname)
cap<-ln[cap]+2
if(length(cap) == 1){
term<-grep('</table>', x[cap:length(x)])[1]+cap-2
content<-x[cap:term]
if(length(grep('No Data for', content))>0){
return(NA)
}
ti<-gsub('<th[^<>]+>', '', trimws(x[cap+2]))
ti<-gsub('</th>', ',', ti)
ti<-gsub('<br>', ' ', ti)
ti<-strsplit(ti,split=',')[[1]]
content[grep('<[^<>]*tr[^<>]*>', content)]<-'SEPARATOR'
content<-strsplit(paste(content, collapse = ''), split='SEPARATOR')[[1]]
content<-content[grep('<td>.+</td>', content)]
content<-gsub('<td[^<>]*>', '', trimws(content))
content<-gsub('</td>$', '', content)
content<-gsub('</td>', '\t', content)
tab<-as.data.frame(t(sapply(content,function(x) strsplit(x, split='\t')[[1]])), stringsAsFactors=FALSE)
colnames(tab)<-ti
rownames(tab)<-1:nrow(tab)
tab[tab=='']
return(tab)
}
else{
return(NA)
}
}
myparse<-function(i){
#Function to parse htmls and retrieve information
#Only for sapply
fname<-paste(i, '.html', sep = '')
#Read files when they exist
myinfo<-rep(NA, 39)
myinfo[1]<-i
if(file.exists(fname)){
x<-scan(file=fname, what='', sep='\n', quiet = TRUE)
getit<-function(i){
myreg(col.patterns[i],x,col.repat[i],numonly = col.num[i])
}
myinfo[usearch]<-sapply(usearch, getit)
myinfo[24]<-myreg('<td>Garage</td>',x,'\\S+',numonly = TRUE, nextline = 1)
extab<-catchtab(x,'Extra Features')
if(class(extab)=='data.frame'){
myinfo[19]<- sum(money2num(extab[,grep('[Vv][Aa][Ll][Uu][Ee]', colnames(extab))]))
}
saletab<-catchtab(x,'Ownership History')
if(class(saletab)=='data.frame'){
myinfo[25:39]<-getsale(saletab)
}
}
#Assign value to info
return(myinfo)
}
temp<-sapply(1:100, myparse)
fname='1.html'
x<-scan(file = fname, what='', sep='\n', quiet = TRUE)
myinfo<-rep(NA, 39)
getit<-function(i){
myreg(col.patterns[i],x,col.repat[i],numonly = col.num[i])
}
myinfo[usearch]<-sapply(usearch, getit)
myinfo[24]<-myreg('<td>Garage</td>',x,'\\S+',numonly = TRUE, nextline = 1)
extab<-catchtab(x,'Extra Features')
if(class(extab)=='data.frame'){
myinfo[19]<- sum(money2num(extab[,grep('[Vv][Aa][Ll][Uu][Ee]', colnames(extab))]))
}
saletab<-catchtab(x,'Ownership History')
if(class(saletab)=='data.frame'){
myinfo[25:39]<-getsale(saletab)
}
saletab
saletab
saletab[1:5,c(1,2,6)]
saletab[1:5]
saletab[1:5,]
saletab[1:5,c(1)]
saletab[1:5,c(1,2)]
saletab[1:5,c(1,2,6)]
saletab[1:5,c('Owner','Sale Price','Sale Date')]
getsale<-function(tab){
as.vector(t(as.matrix(tab[1:5,[1:5,c('Owner','Sale Price','Sale Date')])))
}
getsale<-function(tab){
as.vector(t(as.matrix(tab[1:5,c('Owner','Sale Price','Sale Date')])))
}
temp<-sapply(1:100, myparse)
temp
getsale<-function(tab){
tab[,'Sale Price']<-money2num(tab[,'Sale Price'])
as.vector(t(as.matrix(tab[1:5,c('Owner','Sale Price','Sale Date')])))
}
getsale<-function(tab){
tab<-gsub('&amp', '&', tab)
tab[,'Sale Price']<-money2num(tab[,'Sale Price'])
as.vector(t(as.matrix(tab[1:5,c('Owner','Sale Price','Sale Date')])))
}
temp<-sapply(1:100, myparse)
saletab
saletab['Sale PrICE']
saletab[,'Sale Price']
getsale<-function(tab){
tab<-gsub('&amp', '&', tab)
#  tab[,'Sale Price']<-money2num(tab[,'Sale Price'])
as.vector(t(as.matrix(tab[1:5,c('Owner','Sale Price','Sale Date')])))
}
temp<-sapply(1:100, myparse)
temp<-sapply(1:10, myparse)
temp<-sapply(1, myparse)
saletab
saletab
saletab$`Sale Price`
fname='1.html'
x<-scan(file = fname, what='', sep='\n', quiet = TRUE)
myinfo<-rep(NA, 39)
getit<-function(i){
myreg(col.patterns[i],x,col.repat[i],numonly = col.num[i])
}
myinfo[usearch]<-sapply(usearch, getit)
myinfo[24]<-myreg('<td>Garage</td>',x,'\\S+',numonly = TRUE, nextline = 1)
extab<-catchtab(x,'Extra Features')
if(class(extab)=='data.frame'){
myinfo[19]<- sum(money2num(extab[,grep('[Vv][Aa][Ll][Uu][Ee]', colnames(extab))]))
}
saletab<-catchtab(x,'Ownership History')
if(class(saletab)=='data.frame'){
myinfo[25:39]<-getsale(saletab)
}
saletab[1:5, c("Owner", "Sale Price", "Sale Date")]
getsale<-function(tab){
tab<-gsub('&amp', '&', tab)
tab[,'Sale Price']<-money2num(tab[,'Sale Price'])
as.vector(t(as.matrix(tab[1:5,c('Owner','Sale Price','Sale Date')])))
}
getsale(saletab)
saletab[,"Sale Price"]
tab<-gsub('&amp', '&', saletab)
tab
saletab
saletab
getsale<-function(tab){
tab[,'Owner']<-gsub('&amp', '&', tab[,'Owner'])
tab[,'Sale Price']<-money2num(tab[,'Sale Price'])
as.vector(t(as.matrix(tab[1:5,c('Owner','Sale Price','Sale Date')])))
}
temp<-sapply(1:10, myparse)
temp
getsale<-function(tab){
tab[,'Owner']<-gsub('&amp', '&', tab[,'Owner'])
tab[,'Sale Price']<-money2num(tab[,'Sale Price'])
sales<-as.vector(t(as.matrix(tab[1:5,c('Owner','Sale Price','Sale Date')])))
return(trimws(sales))
}
temp<-sapply(1:10, myparse)
tmep
temp
myinfo
col.names
col.num[14]
grep('+',NA)
myparse<-function(i){
#Function to parse htmls and retrieve information
#Only for sapply
fname<-paste(i, '.html', sep = '')
#Read files when they exist
myinfo<-rep(NA, 40)
myinfo[40:41]<-FALSE
myinfo[1]<-i
if(file.exists(fname)){
x<-scan(file=fname, what='', sep='\n', quiet = TRUE)
getit<-function(i){
myreg(col.patterns[i],x,col.repat[i],numonly = col.num[i])
}
myinfo[usearch]<-sapply(usearch, getit)
myinfo[24]<-myreg('<td>Garage</td>',x,'\\S+',numonly = TRUE, nextline = 1)
extab<-catchtab(x,'Extra Features')
if(class(extab)=='data.frame'){
myinfo[19]<- sum(money2num(extab[,grep('[Vv][Aa][Ll][Uu][Ee]', colnames(extab))]))
}
saletab<-catchtab(x,'Ownership History')
if(class(saletab)=='data.frame'){
myinfo[25:39]<-getsale(saletab)
}
if(length(grep('Building 2', x)) > 0){
myinfo[40]<-TRUE
}
if(length(grep('+',myinfo[14]))>1){
myinfo[41]<-TRUE
}
myinfo[14]<as.numeric(gsub('[^0-9\\.]', '', myinfo[14]))
}
#Assign value to info
return(myinfo)
}
temp<-sapply(1:10, myparse)
temp
temp<-sapply(1:27307, myparse)
myparse<-function(i){
#Function to parse htmls and retrieve information
#Only for sapply
fname<-paste(i, '.html', sep = '')
#Read files when they exist
myinfo<-rep(NA, 40)
myinfo[40:41]<-FALSE
myinfo[1]<-i
if(file.exists(fname)){
x<-scan(file=fname, what='', sep='\n', quiet = TRUE)
getit<-function(i){
myreg(col.patterns[i],x,col.repat[i],numonly = col.num[i])
}
myinfo[usearch]<-sapply(usearch, getit)
myinfo[24]<-myreg('<td>Garage</td>',x,'\\S+',numonly = TRUE, nextline = 1)
extab<-catchtab(x,'Extra Features')
if(class(extab)=='data.frame'){
myinfo[19]<- sum(money2num(extab[,grep('[Vv][Aa][Ll][Uu][Ee]', colnames(extab))]))
}
saletab<-catchtab(x,'Ownership History')
if(class(saletab)=='data.frame'){
myinfo[25:39]<-getsale(saletab)
}
if(length(grep('Building 2', x)) > 0){
myinfo[40]<-TRUE
}
if(length(grep('+',myinfo[14]))>1){
myinfo[41]<-TRUE
}
myinfo[14]<as.numeric(gsub('[^0-9\\.]', '', myinfo[14]))
}
print(i)
#Assign value to info
return(myinfo)
}
temp<-sapply(1:27307, myparse)
View(temp)
info<-as.data.frame(t(temp),stringsAsFactors = FALSE)
save(info,file = 'info.rda')
head(info)
sapply(1:5,function(x) paste('owner', sep=''))
sapply(1:5,function(x) paste('owner',x, sep=''))
sapply(1:5,function(i) sapply(c('buyer','price','date'),function(x) paste(x, i, sep='')))
sapply(1:5,function(i) sapply(c('buyer','price','date'),function(x) paste(x, i, sep='')))
as.vector(sapply(1:5,function(i) sapply(c('buyer','price','date'),
function(x) paste(x, i, sep=''))))
saleinfo<-as.vector(sapply(1:5,function(i) sapply(c('buyer','price','date'),
function(x) paste(x, i, sep=''))))
length(col.num)
length(col.names)
length(col.patterns)
col.num<-rep(FALSE, 24)
col.names[26]
col.names[29]
col.names[25:41]<-c(saleinfo, 'multibuilding', 'nineplus')
col.names
temp[,24]
info[,24]
table(info[,24])
col.names
col.num<-rep(FALSE, 41)
col.num[c(3,6,7,8,15,16,20,23,24,26,29,32,35,38)]<-TRUE
info<-tonum(info, col.num)
tonum<-function(x, trans){
#Funtion to transform 'trans' columns of x
#Usage tonum(DATA, COLUMNS)
for(i in trans){
x[,i]<-as.numeric(x[,i])
}
return(x)
}
info<-tonum(info, col.num)
head(info)
info[,3]
col.num
info<-tonum(info, which(col.num==TRUE)
)
read('info.rda')
load('info.rda')
dim(info)
info<-tonum(info, which(col.num==TRUE)
)
info[,3]
info[40]
table(info[40])
table(info[41])
info[40]<-info[40]!=0
info[40]
myinfo[14]
info[14]
info[14]
load('info.rda')
info[,14]
grep('+',info[,14])
info[grep('+',info[,14]),14]
grep('+',info[,14])
info[11645,14]
grep('+',info[,14])
grep('\\+',info[,14])
grep('\\+','+')
myparse<-function(i){
#Function to parse htmls and retrieve information
#Only for sapply
fname<-paste(i, '.html', sep = '')
#Read files when they exist
myinfo<-rep(NA, 40)
myinfo[40:41]<-0
myinfo[1]<-i
if(file.exists(fname)){
x<-scan(file=fname, what='', sep='\n', quiet = TRUE)
getit<-function(i){
myreg(col.patterns[i],x,col.repat[i],numonly = col.num[i])
}
myinfo[usearch]<-sapply(usearch, getit)
myinfo[24]<-myreg('<td>Garage</td>',x,'\\S+',numonly = TRUE, nextline = 1)
extab<-catchtab(x,'Extra Features')
if(class(extab)=='data.frame'){
myinfo[19]<- sum(money2num(extab[,grep('[Vv][Aa][Ll][Uu][Ee]', colnames(extab))]))
}
saletab<-catchtab(x,'Ownership History')
if(class(saletab)=='data.frame'){
myinfo[25:39]<-getsale(saletab)
}
if(length(grep('Building 2', x)) > 0){
myinfo[40]<-1
}
if(length(grep('\\+',myinfo[14]))>1){
myinfo[41]<-0
}
myinfo[14]<-as.numeric(gsub('[^0-9\\.]', '', myinfo[14]))
}
print(i)
#Assign value to info
return(myinfo)
}
temp<-sapply(1:100, myparse)
temp
temp[14,]
temp<-sapply(1:27307, myparse)
temp
myparse<-function(i){
#Function to parse htmls and retrieve information
#Only for sapply
fname<-paste(i, '.html', sep = '')
#Read files when they exist
myinfo<-rep(NA, 40)
myinfo[40:41]<-0
myinfo[1]<-i
if(file.exists(fname)){
x<-scan(file=fname, what='', sep='\n', quiet = TRUE)
getit<-function(i){
myreg(col.patterns[i],x,col.repat[i],numonly = col.num[i])
}
myinfo[usearch]<-sapply(usearch, getit)
myinfo[24]<-myreg('<td>Garage</td>',x,'\\S+',numonly = TRUE, nextline = 1)
extab<-catchtab(x,'Extra Features')
if(class(extab)=='data.frame'){
myinfo[19]<- sum(money2num(extab[,grep('[Vv][Aa][Ll][Uu][Ee]', colnames(extab))]))
}
saletab<-catchtab(x,'Ownership History')
if(class(saletab)=='data.frame'){
myinfo[25:39]<-getsale(saletab)
}
if(length(grep('Building 2', x)) > 0){
myinfo[40]<-1
}
if(length(grep('\\+',myinfo[14]))>1){
myinfo[41]<-1
}
myinfo[14]<-as.numeric(gsub('[^0-9\\.]', '', myinfo[14]))
}
#Assign value to info
return(myinfo)
}
col.num[14]
temp<-sapply(1:27307, myparse)
system.time(temp<-sapply(1:27307, myparse))
dim(temp)
myparse<-function(i){
#Function to parse htmls and retrieve information
#Only for sapply
fname<-paste(i, '.html', sep = '')
#Read files when they exist
myinfo<-rep(NA, 40)
myinfo[40:41]<-0
myinfo[1]<-i
if(file.exists(fname)){
x<-scan(file=fname, what='', sep='\n', quiet = TRUE)
getit<-function(i){
myreg(col.patterns[i],x,col.repat[i],numonly = col.num[i])
}
myinfo[usearch]<-sapply(usearch, getit)
myinfo[24]<-myreg('<td>Garage</td>',x,'\\S+',numonly = TRUE, nextline = 1)
extab<-catchtab(x,'Extra Features')
if(class(extab)=='data.frame'){
myinfo[19]<- sum(money2num(extab[,grep('[Vv][Aa][Ll][Uu][Ee]', colnames(extab))]))
}
saletab<-catchtab(x,'Ownership History')
if(class(saletab)=='data.frame'){
myinfo[25:39]<-getsale(saletab)
}
if(length(grep('Building 2', x)) > 0){
myinfo[40]<-1
}
if(length(grep('\\+',myinfo[14]))>0){
myinfo[41]<-1
}
myinfo[14]<-as.numeric(gsub('[^0-9\\.]', '', myinfo[14]))
}
#Assign value to info
return(myinfo)
}
system.time(temp<-sapply(1:27307, myparse))
info<-as.data.frame(t(temp),stringsAsFactors = FALSE)
info[,41]
which(info[,41]==1)
info[,14][which(info[,41]==1)]
save(info,file='info.rda')
info<-tonum(info, which(col.num==TRUE))
info[40]<-info[40]!=0
info[41]<-info[41]!=0
info[40]
which(info[40]==TRUE)
which(info[41]==TRUE)
colnames(info)<-col.names
View(info)
write.csv(x = info, file = '625.csv', quote = FALSE, row.names = FALSE)
write.csv(x = info, file = '~/Courses/625_project/625.csv', quote = FALSE, row.names = FALSE)
dim(info)
load('info.rda')
info[41]
info[40]
info[41]
info[3]
info[1]
info[]
2
info[2]
info<-tonum(info, which(col.num==TRUE))
#Transform the logic columns into the right form
info[,40]<-info[,40]!=0
info[is.na(info[2],40)]<-NA
info[,41]<-info[,41]!=0
info[is.na(info[2],41)]<-NA
colnames(info)<-col.names
load('info.rda')
info[,40]<-info[,40]!=0
info[is.na(info[,2]),40]<-NA
info[,41]<-info[,41]!=0
info[is.na(info[,2]),41]<-NA
colnames(info)<-col.names
write.csv(x = info, file = '625.csv', quote = FALSE, row.names = FALSE)
write.csv(x = info, file = '~/Courses/625_project/frank/625.csv', quote = FALSE, row.names = FALSE)
info[122,]
load('info.rda')
info<-tonum(info, which(col.num==TRUE))
#Transform the logic columns into the right form
info[,40]<-info[,40]!=0
info[is.na(info[,2]),40]<-NA
info[,41]<-info[,41]!=0
info[is.na(info[,14]),41]<-NA
colnames(info)<-col.names
info<-tonum(info, which(col.num==TRUE))
#Transform the logic columns into the right form
info[,40]<-info[,40]!=0
info[is.na(info[,2]),40]<-NA
info[,41]<-info[,41]!=0
info[is.na(info[,14]),41]<-NA
colnames(info)<-col.names
load('info.rda')
info<-as.data.frame(t(temp),stringsAsFactors = FALSE)
info<-tonum(info, which(col.num==TRUE))
#Transform the logic columns into the right form
info[,40]<-info[,40]!=0
info[is.na(info[,2]),40]<-NA
info[,41]<-info[,41]!=0
info[is.na(info[,14]),41]<-NA
colnames(info)<-col.names
#Write data into csv file
write.csv(x = info, file = '625.csv', quote = FALSE, row.names = FALSE, sep='\t')
write.table(x = info, file = '625.csv', quote = FALSE, row.names = FALSE, sep='\t')
write.table(x = info, file = '~/Courses/625_project/frank/625.csv', quote = FALSE, row.names = FALSE, sep='\t')
saletab
extab
gsub(',', ';', info)
gsub(',', ' ',info[,4])
ccol.names
col.names
for(i in c(4, 25, 28, 31, 34, 37)){
info[,i]<-gsub(',', '', info[, i])
}
info[,2]
info[,4]
#Write data into csv file
write.csv(x = info, file = '625.csv', quote = FALSE, row.names = FALSE)
dim(info)
#Write data into csv file
write.csv(x = info, file = '~/Courses/625_project/frank/625.csv', quote = FALSE, row.names = FALSE)
