dir()
grep('csv', files)
files<-dir()
grep('csv', files)
x<-read.csv('geocoded_yx267.csv', as.is=TRUE)
View(x)
x<-as.data.frame(matrix(NA,ncol = 4, nrow = 1))
x<-as.data.frame(matrix(NA,ncol = 4, nrow = 1))
for(file in files){
x<-rbind(read.csv(file, as.is=TRUE))
}
x<-as.data.frame(matrix(NA,ncol = 4, nrow = 1))
for(file in files){
print(file)
x<-rbind(read.csv(file, as.is=TRUE))
}
files<-dir()
files<-files[grep('csv', files)]
x<-as.data.frame(matrix(NA,ncol = 4, nrow = 1))
for(file in files){
print(file)
x<-rbind(read.csv(file, as.is=TRUE))
}
View(x)
unique(x)
View(unique(x))
dim(x)
files<-dir()
files<-files[grep('csv', files)]
x<-as.data.frame(matrix(NA,ncol = 4, nrow = 1))
for(file in files){
print(file)
x<-rbind(x, read.csv(file, as.is=TRUE))
}
files<-dir()
files<-files[grep('csv', files)]
x<-as.data.frame(matrix(NA,ncol = 4, nrow = 1))
names(x)<-c('pid', 'location', 'lat', 'lon')
for(file in files){
print(file)
x<-rbind(x, read.csv(file, as.is=TRUE))
}
View(x)
dim(unique(x))
x<-unique(x)
View(x)
is.na(x[,3])
x[!is.na(x[,3]),]
test<-x[!is.na(x[,3]),]
View(test)
dim(x)
dim(unique(x))
dim(test)
testid<-function(i){
ln<-grep(as.character(i), x[,1])
if(all(is.na(x[ln,3]))){
return(i)
}
else{
return(NA)
}
}
testid(1)
testid(2)
testid(1:27307)
sapply(1:27307,x)
sapply(1:27307,testid)
sapply(1:10,testid)
sapply(1:100,testid)
nullid<-sapply(1:27307,testid)
test<-x[!is.na(x[,3]),]
files<-dir()
files<-files[grep('csv', files)]
x<-as.data.frame(matrix(NA,ncol = 4, nrow = 1))
names(x)<-c('pid', 'location', 'lat', 'lon')
for(file in files){
print(file)
x<-rbind(x, read.csv(file, as.is=TRUE))
}
test<-unique(x)
table(test[,1])
dim(test)
nums<-table(test)
table(test[,1])
nums<-table(test[,1])
nums
class(nums)
nums[1,]
nums
str(nums)
View(nums)
nums['Freq']
nums<-as.data.frame(table(test[,1]))
out<-test[!is.na(x[,3]), nums$Freq>1]
out<-test[!is.na(x[,3]) & nums$Freq>1, ]
test<-unique(x)
nums<-as.data.frame(table(test[,1]))
testid<-function(i){
ln<-grep(as.character(i), test[,1])
if(nums$Freq[i]>1){
return(ln[which(!is.na(test[ln,]))])
}
}
testid<-function(i){
ln<-grep(as.character(i), test[,1])
if(nums$Freq[i]>1){
return(ln[which(!is.na(test[ln,]))])
}
else{
return(NA)
}
}
testid<-function(i){
ln<-grep(as.character(i), test[,1])
if(nums$Freq[i]>1){
return(ln[which(!is.na(test[ln,]))])
}
else{
return(ln)
}
}
testid(1)
testid<-function(i){
ln<-grep(as.character(i), test[,1])
if(nums$Freq[i]>1){
return(ln[which(!is.na(test[ln, 3]))])
}
else{
return(ln)
}
}
testid(1)
test[testid(1)]
test[testid(1),]
test[testid(1),]
nums$Freq>1
testid(1)
grep('1',test[,1])
grep('^1$',test[,1])
testid<-function(i){
ln<-grep(paste('^', as.character(i), '$', collapse = ''), test[,1])
print(ln)
if(nums$Freq[i]>1){
return(ln[which(!is.na(test[ln, 3]))])
}
else{
return(ln)
}
}
testid(1)
grep(paste('^', as.character(i), '$', collapse = ''), test[,1])
i<-1
grep(paste('^', as.character(i), '$', collapse = ''), test[,1])
paste('^', as.character(i), '$', collapse = '')
paste('^', '1', '$', collapse = ''
)
?paste
paste('^', as.character(i), '$', collapse = '\\1')
paste(c('^', as.character(i), '$'), collapse = '\\1')
testid<-function(i){
ln<-grep(gsub(' ', '', paste(c('^', as.character(i), '$'), collapse = '')), test[,1])
if(nums$Freq[i]>1){
return(ln[which(!is.na(test[ln, 3]))])
}
else{
return(ln)
}
}
testid(1)
allrows<-sapply(1:27307, testid)
nanums<-which(nums$Freq==1)
nanums
no.na<-test[!is.na(test[,3]), ]
View(no.na)
all.na<-test[is.na(test[,3]), ]
View(all.na)
x<-x[-1,]
test<-unique(x)
no.na<-test[!is.na(test[,3]), ]
all.na<-test[is.na(test[,3]), ]
View(all.na)
order(all.na[,1])
tail(order(all.na[,1]))
order(c(1,3,4,2,5))
c(1,2,3,4,5)[order(c(1,3,4,2,5))]
?order
c(1,3,4,2,5)[order(c(1,3,4,2,5))]
all.na<-all.na[order(all.na[,1]), ]
View(all.na)
all.na[1,]
nums<-as.data.frame(table(test[,1]))
nanums<-which(nums$Freq==1)
allrows<-rbind(no.na, all.na[nanums,])
allrows
View(allrows)
dim(allrows)
dim(no.na)
nanums<-which(nums$Freq==1)
nanums
allrows<-unique(allrows)
dim(allrows)
all.na[nanums,]
dim(all.na[nanums,])
unique(dim(all.na[nanums,]))
View(dim(all.na[nanums,]))
View(all.na[nanums,])
View(no.na)
View(no.na)
dim(allrows)
allrows[1,]
table(allrows[,1])
which(test[,1]==9977)
which(allrows[,1]==9977)
allrows[22286,23284]
allrows[c(22286,23284),]
files<-dir()
files<-files[grep('csv', files)]
x<-as.data.frame(matrix(NA,ncol = 4, nrow = 1))
names(x)<-c('pid', 'location', 'lat', 'lon')
for(file in files){
print(file)
x<-rbind(x, read.csv(file, as.is=TRUE))
}
x<-x[-1,]
test<-unique(x)
no.na<-test[!is.na(test[,3]), ]
all.na<-test[is.na(test[,3]), ]
all.na<-all.na[order(all.na[,1]), ]
nums<-as.data.frame(table(test[,1]))
nanums<-which(nums$Freq==1)
allrows<-rbind(no.na, all.na[nanums,])
dim(allrows)
sapply(1:length(x), function(i) {paste(x[i,], collapse = ',')})
rowchar<-sapply(1:nrow(x), function(i) {paste(x[i,], collapse = ',')})
table(rowchar)
table(rowchar)
counts<-as.data.frame(table(rowchar))
View(counts)
which(counts$Freq==1)
View(which(counts$Freq==1))
length(which(counts$Freq==1))
table(allrows[,1])
files<-dir()
files<-files[grep('csv', files)]
x<-as.data.frame(matrix(NA,ncol = 4, nrow = 1))
names(x)<-c('pid', 'location', 'lat', 'lon')
for(file in files){
print(file)
x<-rbind(x, read.csv(file, as.is=TRUE))
}
x<-x[-1,]
rowchar<-sapply(1:nrow(x), function(i) {paste(x[i,], collapse = ',')})
files<-dir()
files<-files[grep('csv', files)]
x<-as.data.frame(matrix(NA,ncol = 4, nrow = 1))
names(x)<-c('pid', 'location', 'lat', 'lon')
for(file in files){
print(file)
x<-rbind(x, read.csv(file, as.is=TRUE))
}
x<-x[-1,]
#rowchar<-sapply(1:nrow(x), function(i) {paste(x[i,], collapse = ',')})
counts<-as.data.frame(table(rowchar))
table(rowchar)
test<-unique(x)
no.na<-test[!is.na(test[,3]), ]
all.na<-test[is.na(test[,3]), ]
all.na<-all.na[order(all.na[,1]), ]
nums<-as.data.frame(table(test[,1]))
nanums<-which(nums$Freq==1)
allrows<-rbind(no.na, all.na[nanums,])
dim(allrows)
View(allrows)
allrows<-allrows[order(allrows[,1]), ]
View(allrows)
rownames(allrows)<-1:nrow(allrows)
View(allrows)
files<-dir()
files<-files[grep('csv', files)]
x<-as.data.frame(matrix(NA,ncol = 4, nrow = 1))
names(x)<-c('pid', 'location', 'lat', 'lon')
for(file in files){
print(file)
x<-rbind(x, read.csv(file, as.is=TRUE))
}
x<-x[-1,]
#rowchar<-sapply(1:nrow(x), function(i) {paste(x[i,], collapse = ',')})
counts<-as.data.frame(table(rowchar))
table(rowchar)
test<-unique(x)
no.na<-test[!is.na(test[,3]), ]
all.na<-test[is.na(test[,3]), ]
all.na<-all.na[order(all.na[,1]), ]
nums<-as.data.frame(table(test[,1]))
nanums<-which(nums$Freq==1)
allrows<-rbind(no.na, all.na[nanums,])
allrows<-allrows[order(allrows[,1]), ]
rownames(allrows)<-1:nrow(allrows)
View(allrows)
which(allrows$location==NA)
which(is.na(allrows$location))
allrows[is.na(allrows$location),]
x <- read.csv("http://www.stat.yale.edu/~jay/625/.hidden/NHlocations.csv", as.is=TRUE)
View(x)
allrows[is.na(allrows$location),c(3,4)]<-NA
View(allrows)
netids<-c('hl642', 'se362')
##
## WARNING: This script will take about 15 minutes to run.
##
#####################################################
# Don't change anything below.  Run the entire script
# in some folder where you've put the script and the
# 625location.csv file.  The result will be a file
# like geocoded_netid.csv that has your range of
# properties geocoded.  Put this in your Dropbox.com
# folder.
for(netid in netids){
set.seed(1)
n <- read.csv("http://www.stat.yale.edu/~jay/625/.hidden/netids.csv", as.is=TRUE)
n$myval <- sample(1:nrow(n)) %% 28 + 1
if (length(this <- which(n$User.ID==netid))==1) {
myval <- n$myval[this]
} else stop("I don't believe your netid.")
starts <- c(1, seq(1000, 27000, by=1000))
ends <- c(starts[-1] - 1, 27307)
x <- read.csv("http://www.stat.yale.edu/~jay/625/.hidden/NHlocations.csv", as.is=TRUE)
x$lat <- NA
x$lon <- NA
if (!require(ggmap)) install.packages("ggmap")
library(ggmap)
# Examples:
#geocode("24 Hillhouse Ave, New Haven, CT")   # Definitely 2500/day
#geocode("24 Hillhouse Ave, New Haven, CT", source="dsk")  # ? limited
myrange <- starts[myval]:ends[myval]
locs <- paste(x$location[myrange], ", New Haven, CT", sep="")
ans <- geocode(locs)
x$lon[myrange] <- ans$lon
x$lat[myrange] <- ans$lat
write.csv(x, paste("geocoded_", netid, ".csv", sep=""),
row.names=F)
print("DONE!  Take the geocoded_netid.csv file and upload to Dropbox.com.")
}
files<-dir()
files<-files[grep('csv', files)]
x<-as.data.frame(matrix(NA,ncol = 4, nrow = 1))
names(x)<-c('pid', 'location', 'lat', 'lon')
for(file in files){
print(file)
x<-rbind(x, read.csv(file, as.is=TRUE))
}
x<-x[-1,]
#rowchar<-sapply(1:nrow(x), function(i) {paste(x[i,], collapse = ',')})
#counts<-as.data.frame(table(rowchar))
#table(rowchar)
test<-unique(x)
no.na<-test[!is.na(test[,3]), ]
all.na<-test[is.na(test[,3]), ]
all.na<-all.na[order(all.na[,1]), ]
nums<-as.data.frame(table(test[,1]))
nanums<-which(nums$Freq==1)
allrows<-rbind(no.na, all.na[nanums,])
allrows<-allrows[order(allrows[,1]), ]
rownames(allrows)<-1:nrow(allrows)
allrows[is.na(allrows$location),c(3,4)]<-NA
View(allrows)
table(allrows$pid)
table(allrows$pid)>=1
table(allrows$pid)
which(table(allrows$pid)>1)
allrows$pid[which(table(allrows$pid)>1)]
library(ggmap)
geocode('20 DONNA DR #A-1')
geocode('20 DONNA DR #A-1, New Haven')
View(no.na)
allrows[,c(3,4)]
all(allrows[,c(3,4)])
apply(allrows[,c(3,4)],1,function(x) all(is.na(x)))
which(allrows$location & apply(allrows[,c(3,4)],1,function(x) all(is.na(x))))
apply(allrows[,c(3,4)],1,function(x) all(is.na(x)))
which(!is.na(allrows$location) & apply(allrows[,c(3,4)],1,function(x) all(is.na(x))))
which(!is.na(allrows$location) & apply(allrows[,c(3,4)],1,function(x) all(is.na(x))))still.na<-which(!is.na(allrows$location) & apply(allrows[,c(3,4)],1,function(x) all(is.na(x))))
still.na<-which(!is.na(allrows$location) & apply(allrows[,c(3,4)],1,function(x) all(is.na(x))))
length(still.na)
?or
ans<-geocode(allrows[still.na,'location'])
files<-dir()
files<-files[grep('csv', files)]
x<-as.data.frame(matrix(NA,ncol = 4, nrow = 1))
names(x)<-c('pid', 'location', 'lat', 'lon')
for(file in files){
print(file)
x<-rbind(x, read.csv(file, as.is=TRUE))
}
x<-x[-1,]
#rowchar<-sapply(1:nrow(x), function(i) {paste(x[i,], collapse = ',')})
#counts<-as.data.frame(table(rowchar))
#table(rowchar)
test<-unique(x)
no.na<-test[!is.na(test[,3]), ]
all.na<-test[is.na(test[,3]), ]
all.na<-all.na[order(all.na[,1]), ]
nums<-as.data.frame(table(test[,1]))
nanums<-which(nums$Freq==1)
allrows<-rbind(no.na, all.na[nanums,])
allrows<-allrows[order(allrows[,1]), ]
rownames(allrows)<-1:nrow(allrows)
allrows[is.na(allrows$location),c(3,4)]<-NA
still.na<-which(!is.na(allrows$location) &
apply(allrows[,c(3,4)],1,function(x) all(is.na(x))))
ans<-geocode(allrows[still.na,'location'])
ans
allrows[still.na,'location']
allrows[still.na,'location'][1]
ans[1]
ans$lon
is.na(ans$lon)
which(!is.na(ans$lon))
locs<-paste(allrows[still.na,'location'], ", New Haven, CT", sep="")
locs
ans$lon
allrows[still.na,'location']
geocode('250 DAVENPORT AV')
locs<-paste(allrows[still.na,'location'], ", New Haven, CT", sep="")
length(still.na)
geocode('250 DAVENPORT AV')
