temp
ncol(temp)
temp <- gsub("(<[^<>]*>)|(\t)|(\\$)|,", "", temp, perl = TRUE)[1:min(5,nrow(temp)), c(1,2,ncol(temp))]
temp
temp <- c(as.vector(t(temp)), rep(NA, (5-nrow(temp))*3))
temp
files <- dir("samplefiles", full.names = TRUE)
z <- as.data.frame(matrix(NA, length(files), 15))
names(z) <- paste(rep(c("buyer", "price", "date"), 5), rep(1:5, each=3), sep="")
for (i in 1:length(files)) {
print(i)
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- matrix(unlist(temp), ncol=length(temp[[1]]), byrow=TRUE)
temp <- as.matrix(gsub("(<[^<>]*>)|(\t)|(\\$)|,", "",
temp, perl = TRUE)[1:min(5,nrow(temp)), c(1,2,ncol(temp))])
temp <- c(as.vector(t(temp)), rep(NA, (5-nrow(temp))*3))
z[i,] <- temp    # Not right because of the row/pid issue, but....
# End the interesting work.
}
i
files <- dir("samplefiles", full.names = TRUE)
z <- as.data.frame(matrix(NA, length(files), 15))
names(z) <- paste(rep(c("buyer", "price", "date"), 5), rep(1:5, each=3), sep="")
for (i in 1:length(files)) {
print(i)
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- matrix(unlist(temp), ncol=length(temp[[1]]), byrow=TRUE)
temp <- as.matrix(gsub("(<[^<>]*>)|(\t)|(\\$)|,", "",
temp, perl = TRUE))[1:min(5,nrow(temp)), c(1,2,ncol(temp))])
temp <- c(as.vector(t(temp)), rep(NA, (5-nrow(temp))*3))
z[i,] <- temp    # Not right because of the row/pid issue, but....
# End the interesting work.
}
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- matrix(unlist(temp), ncol=length(temp[[1]]), byrow=TRUE)
temp <- as.matrix(gsub("(<[^<>]*>)|(\t)|(\\$)|,", "",
temp, perl = TRUE))[1:min(5,nrow(temp)), c(1,2,ncol(temp))])
files <- dir("samplefiles", full.names = TRUE)
z <- as.data.frame(matrix(NA, length(files), 15))
names(z) <- paste(rep(c("buyer", "price", "date"), 5), rep(1:5, each=3), sep="")
for (i in 1:length(files)) {
print(i)
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- matrix(unlist(temp), ncol=length(temp[[1]]), byrow=TRUE)
temp <- as.matrix(gsub("(<[^<>]*>)|(\t)|(\\$)|,", "",
temp, perl = TRUE)[1:min(5,nrow(temp)), c(1,2,ncol(temp))])
temp <- c(as.vector(t(temp)), rep(NA, (5-nrow(temp))*3))
z[i,] <- temp    # Not right because of the row/pid issue, but....
# End the interesting work.
}
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- matrix(unlist(temp), ncol=length(temp[[1]]), byrow=TRUE)
temp
gsub("(<[^<>]*>)|(\t)|(\\$)|,", "",
temp, perl = TRUE)[1:min(5,nrow(temp)), c(1,2,ncol(temp))]
matrix(gsub("(<[^<>]*>)|(\t)|(\\$)|,", "",
temp, perl = TRUE)[1:min(5,nrow(temp)), c(1,2,ncol(temp))])
temp <- gsub("(<[^<>]*>)|(\t)|(\\$)|,", "", temp, perl = TRUE)[1:min(5,nrow(temp)), c(1,2,ncol(temp))]
temp
i<-4
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- matrix(unlist(temp), ncol=length(temp[[1]]), byrow=TRUE)
temp <- gsub("(<[^<>]*>)|(\t)|(\\$)|,", "", temp, perl = TRUE)[1:min(5,nrow(temp)), c(1,2,ncol(temp))]
temp
temp
temp <- unlist(strsplit(temp, "</td>", fixed=TRUE))
temp
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- unlist(strsplit(temp, "</td>", fixed=TRUE))
temp
print(i)
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- matrix(unlist(temp), ncol=length(temp[[1]]), byrow=TRUE)
temp <- as.vector(gsub("(<[^<>]*>)|(\t)|(\\$)|,", "",
temp, perl = TRUE)[1:min(5,nrow(temp)), c(1,2,ncol(temp))])
temp
temp <- unlist(strsplit(temp, "</td>", fixed=TRUE))
temp
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- unlist(strsplit(temp, "</td>", fixed=TRUE))
temp
temp <- gsub("(<[^<>]*>)|(\t)|(\\$)|,", "", temp, perl = TRUE)
temp
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp
temp <- unlist(gsub("(<[^<>]*>)|(\t)|(\\$)|,", "", temp, perl = TRUE))
temp
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp
print(i)
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp
gsub("(<[^<>]*>)|(\t)|(\\$)|,", "", temp, perl = TRUE)
lapply(temp, function(x) gsub("(<[^<>]*>)|(\t)|(\\$)|,",
"", x, perl = TRUE))
temp <- lapply(temp, function(x) gsub("(<[^<>]*>)|(\t)|(\\$)|,",
"", x, perl = TRUE))
temp
print(i)
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- lapply(temp, function(x) gsub("(<[^<>]*>)|(\t)|(\\$)|,",
"", x, perl = TRUE))
rownum<-length(temp)
colnum<-length(temp[[1]])
temp<-matrix(temp, ncol=colnum)[1:min(5,rownum), c(1,2,colnum)]
temp
print(i)
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- lapply(temp, function(x) gsub("(<[^<>]*>)|(\t)|(\\$)|,",
"", x, perl = TRUE))
rownum<-length(temp)
colnum<-length(temp[[1]])
temp<-matrix(unlist(temp), ncol=colnum)[1:min(5,rownum), c(1,2,colnum)]
temp
colnum
print(i)
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- lapply(temp, function(x) gsub("(<[^<>]*>)|(\t)|(\\$)|,",
"", x, perl = TRUE))
rownum<-length(temp)
colnum<-length(temp[[1]])
matrix(unlist(temp), ncol=colnum)
unlist(temp)
print(i)
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- lapply(temp, function(x) gsub("(<[^<>]*>)|(\t)|(\\$)|,",
"", x, perl = TRUE))
rownum<-length(temp)
colnum<-length(temp[[1]])
temp<-matrix(unlist(temp), ncol=colnum, byrow = TRUE)[1:min(5,rownum), c(1,2,colnum)]
temp
temp <- c(as.vector(t(temp)), rep(NA, (5-nrow(temp))*3))
temp
files <- dir("samplefiles", full.names = TRUE)
z <- as.data.frame(matrix(NA, length(files), 15))
names(z) <- paste(rep(c("buyer", "price", "date"), 5), rep(1:5, each=3), sep="")
for (i in 1:length(files)) {
print(i)
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- lapply(temp, function(x) gsub("(<[^<>]*>)|(\t)|(\\$)|,",
"", x, perl = TRUE))
rownum<-length(temp)
colnum<-length(temp[[1]])
temp<-matrix(unlist(temp), ncol=colnum, byrow = TRUE)[1:min(5,rownum), c(1,2,colnum)]
temp <- c(as.vector(t(temp)), rep(NA, (5-nrow(temp))*3))
z[i,] <- temp    # Not right because of the row/pid issue, but....
# End the interesting work.
}
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- lapply(temp, function(x) gsub("(<[^<>]*>)|(\t)|(\\$)|,",
"", x, perl = TRUE))
rownum<-length(temp)
colnum<-length(temp[[1]])
temp<-matrix(unlist(temp), ncol=colnum, byrow = TRUE)[1:min(5,rownum), c(1,2,colnum)]
temp
temp
i<-4
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- lapply(temp, function(x) gsub("(<[^<>]*>)|(\t)|(\\$)|,",
"", x, perl = TRUE))
rownum<-length(temp)
colnum<-length(temp[[1]])
temp<-matrix(unlist(temp), ncol=colnum, byrow = TRUE)[1:min(5,rownum), c(1,2,colnum)]
temp
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- lapply(temp, function(x) gsub("(<[^<>]*>)|(\t)|(\\$)|,",
"", x, perl = TRUE))
rownum<-length(temp)
colnum<-length(temp[[1]])
temp<-matrix(unlist(temp), ncol=rownum)[c(1,2,colnum),1:min(5,rownum)]
temp
temp <- c(as.vector(temp), rep(NA, (5-nrow(temp))*3))
temp
files <- dir("samplefiles", full.names = TRUE)
z <- as.data.frame(matrix(NA, length(files), 15))
names(z) <- paste(rep(c("buyer", "price", "date"), 5), rep(1:5, each=3), sep="")
for (i in 1:length(files)) {
print(i)
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- lapply(temp, function(x) gsub("(<[^<>]*>)|(\t)|(\\$)|,",
"", x, perl = TRUE))
rownum<-length(temp)
colnum<-length(temp[[1]])
temp<-matrix(unlist(temp), ncol=rownum)[c(1,2,colnum),1:min(5,rownum)]
temp <- c(as.vector(temp), rep(NA, (5-nrow(temp))*3))
z[i,] <- temp    # Not right because of the row/pid issue, but....
# End the interesting work.
}
i
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- lapply(temp, function(x) gsub("(<[^<>]*>)|(\t)|(\\$)|,",
"", x, perl = TRUE))
rownum<-length(temp)
colnum<-length(temp[[1]])
temp<-matrix(unlist(temp), ncol=rownum)[c(1,2,colnum),1:min(5,rownum)]
temp
temp <- c(as.vector(temp), rep(NA, (5-nrow(temp))*3))
nrow(temp)
rownum
files <- dir("samplefiles", full.names = TRUE)
z <- as.data.frame(matrix(NA, length(files), 15))
names(z) <- paste(rep(c("buyer", "price", "date"), 5), rep(1:5, each=3), sep="")
for (i in 1:length(files)) {
print(i)
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- lapply(temp, function(x) gsub("(<[^<>]*>)|(\t)|(\\$)|,",
"", x, perl = TRUE))
rownum<-length(temp)
colnum<-length(temp[[1]])
temp<-matrix(unlist(temp), ncol=rownum)[c(1,2,colnum),1:min(5,rownum)]
temp <- c(as.vector(temp), rep(NA, (5-rownum)*3))
z[i,] <- temp    # Not right because of the row/pid issue, but....
# End the interesting work.
}
z
View(z)
K<-z
View(K)
files <- dir("samplefiles", full.names = TRUE)
z <- as.data.frame(matrix(NA, length(files), 15))
names(z) <- paste(rep(c("buyer", "price", "date"), 5), rep(1:5, each=3), sep="")
for (i in 1:length(files)) {
x <- readLines(files[i])
m <- grep("Ownership History", x)[1]
startEnd <- m+grep("<(/)*table", x[m:length(x)])[1:2]-1
tableRows <- x[startEnd[1]:startEnd[2]]
tableRows <- tableRows[grep("$", tableRows, fixed=TRUE)]
tableRows <- strsplit(tableRows, "</td>")
numCols <- length(tableRows[[1]])
numOwners <- length(tableRows) # we're only tracking the latest 5, max
tableRows <- gsub("<[^<>]*>|\t|\\$|,", "", unlist(tableRows))
histdata <- matrix(tableRows, ncol=numCols, byrow=TRUE)
histdata <- histdata[1:min(5, numOwners), c(1:2, numCols), drop=FALSE]
z[i, 1:length(histdata)] <- as.vector(histdata)
}
View(z)
K[,2]
z[,2]
z[,1]
z[,2]
View(z)
z[,'buyer1']
z[,'price1']
#
# Ownership History
#
# The "frame" of this script is just to test the "body" of the loop -- the
# example problem is getting the most five recent sale information fields.
# So you'd need some minor adaptations to fit the code into your
# scripts (i.e. replace my "frame" with your "frame") but the work
# itself (denoted clearly below) is the interesting part.
files <- dir("samplefiles", full.names = TRUE)
z <- as.data.frame(matrix(NA, length(files), 15))
names(z) <- paste(rep(c("buyer", "price", "date"), 5), rep(1:5, each=3), sep="")
for (i in 1:length(files)) {
print(i)
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- lapply(temp, function(x) gsub("(<[^<>]*>)|(\t)|(\\$)|,",
"", x, perl = TRUE))
rownum<-length(temp)
colnum<-length(temp[[1]])
temp<-matrix(unlist(temp), ncol=rownum)[c(1,2,colnum),1:min(5,rownum)]
temp <- c(as.vector(temp), rep(NA, (5-rownum)*3))
z[i,] <- temp    # Not right because of the row/pid issue, but....
# End the interesting work.
}
View(z)
files<-dir()
files<-files[grep('csv', files)]
x<-as.data.frame(matrix(NA,ncol = 4, nrow = 1))
names(x)<-c('pid', 'location', 'lat', 'lon')
for(file in files){
print(file)
x<-rbind(x, read.csv(file, as.is=TRUE))
}
x<-x[-1,]
#rowchar<-sapply(1:nrow(x), function(i) {paste(x[i,], collapse = ',')})
counts<-as.data.frame(table(rowchar))
table(rowchar)
test<-unique(x)
no.na<-test[!is.na(test[,3]), ]
all.na<-test[is.na(test[,3]), ]
all.na<-all.na[order(all.na[,1]), ]
nums<-as.data.frame(table(test[,1]))
nanums<-which(nums$Freq==1)
allrows<-rbind(no.na, all.na[nanums,])
allrows<-allrows[order(allrows[,1]), ]
rownames(allrows)<-1:nrow(allrows)
allrows
files<-dir()
files<-files[grep('csv', files)]
x<-as.data.frame(matrix(NA,ncol = 4, nrow = 1))
names(x)<-c('pid', 'location', 'lat', 'lon')
for(file in files){
print(file)
x<-rbind(x, read.csv(file, as.is=TRUE))
}
x<-x[-1,]
#rowchar<-sapply(1:nrow(x), function(i) {paste(x[i,], collapse = ',')})
counts<-as.data.frame(table(rowchar))
table(rowchar)
test<-unique(x)
no.na<-test[!is.na(test[,3]), ]
all.na<-test[is.na(test[,3]), ]
all.na<-all.na[order(all.na[,1]), ]
nums<-as.data.frame(table(test[,1]))
nanums<-which(nums$Freq==1)
