rownum<-length(temp)
colnum<-length(temp[[1]])
temp<-matrix(unlist(temp), ncol=rownum)[c(1,2,colnum),1:min(5,rownum)]
temp <- c(as.vector(temp), rep(NA, (5-rownum)*3))
z[i,] <- temp    # Not right because of the row/pid issue, but....
# End the interesting work.
}
View(z)
files<-dir()
files<-files[grep('csv', files)]
x<-as.data.frame(matrix(NA,ncol = 4, nrow = 1))
names(x)<-c('pid', 'location', 'lat', 'lon')
for(file in files){
print(file)
x<-rbind(x, read.csv(file, as.is=TRUE))
}
x<-x[-1,]
#rowchar<-sapply(1:nrow(x), function(i) {paste(x[i,], collapse = ',')})
counts<-as.data.frame(table(rowchar))
table(rowchar)
test<-unique(x)
no.na<-test[!is.na(test[,3]), ]
all.na<-test[is.na(test[,3]), ]
all.na<-all.na[order(all.na[,1]), ]
nums<-as.data.frame(table(test[,1]))
nanums<-which(nums$Freq==1)
allrows<-rbind(no.na, all.na[nanums,])
allrows<-allrows[order(allrows[,1]), ]
rownames(allrows)<-1:nrow(allrows)
allrows
files<-dir()
files<-files[grep('csv', files)]
x<-as.data.frame(matrix(NA,ncol = 4, nrow = 1))
names(x)<-c('pid', 'location', 'lat', 'lon')
for(file in files){
print(file)
x<-rbind(x, read.csv(file, as.is=TRUE))
}
x<-x[-1,]
#rowchar<-sapply(1:nrow(x), function(i) {paste(x[i,], collapse = ',')})
counts<-as.data.frame(table(rowchar))
table(rowchar)
test<-unique(x)
no.na<-test[!is.na(test[,3]), ]
all.na<-test[is.na(test[,3]), ]
all.na<-all.na[order(all.na[,1]), ]
nums<-as.data.frame(table(test[,1]))
nanums<-which(nums$Freq==1)
#
# Ownership History
#
# The "frame" of this script is just to test the "body" of the loop -- the
# example problem is getting the most five recent sale information fields.
# So you'd need some minor adaptations to fit the code into your
# scripts (i.e. replace my "frame" with your "frame") but the work
# itself (denoted clearly below) is the interesting part.
files <- dir("samplefiles", full.names = TRUE)
z <- as.data.frame(matrix(NA, length(files), 15))
names(z) <- paste(rep(c("buyer", "price", "date"), 5), rep(1:5, each=3), sep="")
for (i in 1:length(files)) {
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- lapply(temp, function(x) gsub("(<[^<>]*>)|(\t)|(\\$)|,",
"", x, perl = TRUE))
rownum<-length(temp)
colnum<-length(temp[[1]])
temp<-matrix(unlist(temp), ncol=rownum)[c(1,2,colnum),1:min(5,rownum)]
temp <- c(as.vector(temp), rep(NA, (5-rownum)*3))
z[i,] <- temp    # Not right because of the row/pid issue, but....
# End the interesting work.
}
z
i=1
files <- dir("samplefiles", full.names = TRUE)
z <- as.data.frame(matrix(NA, length(files), 15))
names(z) <- paste(rep(c("buyer", "price", "date"), 5), rep(1:5, each=3), sep="")
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
#Catch the column names
ti<-gsub('<th[^<>]+>', '', trimws(x[cap+2]))
ti<-gsub('&amp;', '&', ti)
ti<-gsub('</th>', ',', ti)
ti<-gsub('<br>', ' ', ti)
ti<-strsplit(ti, split = ',')[[1]]
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- lapply(temp, function(x) gsub("(<[^<>]*>)|(\t)|(\\$)|,",
"", x, perl = TRUE))
rownum<-length(temp)
colnum<-length(temp[[1]])
temp<-matrix(unlist(temp), ncol=rownum)[c(1,2,colnum),1:min(5,rownum)]
temp
ti
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
#Catch the column names
ti<-gsub('<th[^<>]+>', '', trimws(x[start+3]))
ti<-gsub('&amp;', '&', ti)
ti<-gsub('</th>', ',', ti)
ti<-gsub('<br>', ' ', ti)
ti<-strsplit(ti, split = ',')[[1]]
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- lapply(temp, function(x) gsub("(<[^<>]*>)|(\t)|(\\$)|,",
"", x, perl = TRUE))
rownum<-length(temp)
colnum<-length(temp[[1]])
temp<-matrix(unlist(temp), ncol=rownum)[c(1,2,colnum),1:min(5,rownum)]
temp <- c(as.vector(temp), rep(NA, (5-rownum)*3))
z[i,] <- temp    # Not right because of the row/pid issue, but....
ti
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
#Catch the column names
ti<-gsub('<th[^<>]+>', '', trimws(x[start+4]))
ti<-gsub('&amp;', '&', ti)
ti<-gsub('</th>', ',', ti)
ti<-gsub('<br>', ' ', ti)
ti<-strsplit(ti, split = ',')[[1]]
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- lapply(temp, function(x) gsub("(<[^<>]*>)|(\t)|(\\$)|,",
"", x, perl = TRUE))
rownum<-length(temp)
colnum<-length(temp[[1]])
temp<-matrix(unlist(temp), ncol=rownum)[c(1,2,colnum),1:min(5,rownum)]
temp <- c(as.vector(temp), rep(NA, (5-rownum)*3))
z[i,] <- temp    # Not right because of the row/pid issue, but....
# End the interesting work.
ti
temp
temp<-matrix(unlist(temp), ncol=rownum)[c(1,2,colnum),1:min(5,rownum)]
temp
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
#Catch the column names
ti<-gsub('<th[^<>]+>', '', trimws(x[start+4]))
ti<-gsub('&amp;', '&', ti)
ti<-gsub('</th>', ',', ti)
ti<-gsub('<br>', ' ', ti)
ti<-strsplit(ti, split = ',')[[1]]
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- lapply(temp, function(x) gsub("(<[^<>]*>)|(\t)|(\\$)|,",
"", x, perl = TRUE))
rownum<-length(temp)
colnum<-length(temp[[1]])
temp
matrix(unlist(temp), ncol=rownum)
rownames(temp)<-ti
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
#Catch the column names
ti<-gsub('<th[^<>]+>', '', trimws(x[start+4]))
ti<-gsub('&amp;', '&', ti)
ti<-gsub('</th>', ',', ti)
ti<-gsub('<br>', ' ', ti)
ti<-strsplit(ti, split = ',')[[1]]
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- lapply(temp, function(x) gsub("(<[^<>]*>)|(\t)|(\\$)|,",
"", x, perl = TRUE))
rownum<-length(temp)
colnum<-length(temp[[1]])
temp<-matrix(unlist(temp), ncol=rownum)
temp
rownames(temp)<-ti
temp
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
#Catch the column names
ti<-gsub('<th[^<>]+>', '', trimws(x[start+4]))
ti<-gsub('&amp;', '&', ti)
ti<-gsub('</th>', ',', ti)
ti<-gsub('<br>', ' ', ti)
ti<-strsplit(ti, split = ',')[[1]]
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- gsub('&nbsp;', NA, temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- lapply(temp, function(x) gsub("(<[^<>]*>)|(\t)|(\\$)|,",
"", x, perl = TRUE))
rownum<-length(temp)
colnum<-length(temp[[1]])
temp<-matrix(unlist(temp), ncol=rownum)
temp
i
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
#Catch the column names
ti<-gsub('<th[^<>]+>', '', trimws(x[start+4]))
ti<-gsub('&amp;', '&', ti)
ti<-gsub('</th>', ',', ti)
ti<-gsub('<br>', ' ', ti)
ti<-strsplit(ti, split = ',')[[1]]
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp
temp <- gsub('&nbsp;', NA, temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- lapply(temp, function(x) gsub("(<[^<>]*>)|(\t)|(\\$)|,",
"", x, perl = TRUE))
rownum<-length(temp)
colnum<-length(temp[[1]])
tmep
temp
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
#Catch the column names
ti<-gsub('<th[^<>]+>', '', trimws(x[start+4]))
ti<-gsub('&amp;', '&', ti)
ti<-gsub('</th>', ',', ti)
ti<-gsub('<br>', ' ', ti)
ti<-strsplit(ti, split = ',')[[1]]
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- lapply(temp, function(x) gsub("(<[^<>]*>)|(\t)|(\\$)|,",
"", x, perl = TRUE))
temp
rownum<-length(temp)
colnum<-length(temp[[1]])
temp<-matrix(unlist(temp), ncol=rownum)
rownames(temp)<-ti
temp
files <- dir("samplefiles", full.names = TRUE)
z <- as.data.frame(matrix(NA, length(files), 15))
names(z) <- paste(rep(c("buyer", "price", "date"), 5), rep(1:5, each=3), sep="")
for (i in 1:length(files)) {
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
#Catch the column names
ti<-gsub('<th[^<>]+>', '', trimws(x[start+4]))
ti<-gsub('&amp;', '&', ti)
ti<-gsub('</th>', ',', ti)
ti<-gsub('<br>', ' ', ti)
ti<-strsplit(ti, split = ',')[[1]]
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- lapply(temp, function(x) gsub("(<[^<>]*>)|(\t)|(\\$)|,",
"", x, perl = TRUE))
rownum<-length(temp)
colnum<-length(temp[[1]])
temp<-matrix(unlist(temp), ncol=rownum)
rownames(temp)<-ti
temp<-temp[c('Owner','Sale Price','Sale Date'),1:min(5,rownum)]
temp <- c(as.vector(temp), rep(NA, (5-rownum)*3))
z[i,] <- temp    # Not right because of the row/pid issue, but....
# End the interesting work.
}
z
files
files <- dir("/Users/Frank/Courses/STAT625/week1/HW1/VisionAppraisal/newdata2016/", full.names = TRUE)
files
files<-files[grep('[0-9]+.html$', files)]
files <- dir("/Users/Frank/Courses/STAT625/week1/HW1/VisionAppraisal/newdata2016/", full.names = TRUE)
files<-files[grep('[0-9]+.html$', files)]
z <- as.data.frame(matrix(NA, length(files), 15))
names(z) <- paste(rep(c("buyer", "price", "date"), 5), rep(1:5, each=3), sep="")
for (i in 1:length(files)) {
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
#Catch the column names
ti<-gsub('<th[^<>]+>', '', trimws(x[start+4]))
ti<-gsub('&amp;', '&', ti)
ti<-gsub('</th>', ',', ti)
ti<-gsub('<br>', ' ', ti)
ti<-strsplit(ti, split = ',')[[1]]
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- lapply(temp, function(x) gsub("(<[^<>]*>)|(\t)|(\\$)|,",
"", x, perl = TRUE))
rownum<-length(temp)
colnum<-length(temp[[1]])
temp<-matrix(unlist(temp), ncol=rownum)
rownames(temp)<-ti
temp<-temp[c('Owner','Sale Price','Sale Date'),1:min(5,rownum)]
temp <- c(as.vector(temp), rep(NA, (5-rownum)*3))
z[i,] <- temp    # Not right because of the row/pid issue, but....
# End the interesting work.
}
z
dim(z)
files <- dir("samplefiles", full.names = TRUE)
z <- as.data.frame(matrix(NA, length(files), 15))
names(z) <- paste(rep(c("buyer", "price", "date"), 5), rep(1:5, each=3), sep="")
for (i in 1:length(files)) {
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
#Catch the column names
ti<-gsub('<th[^<>]+>', '', trimws(x[start+4]))
ti<-gsub('&amp;', '&', ti)
ti<-gsub('</th>', ',', ti)
ti<-gsub('<br>', ' ', ti)
ti<-strsplit(ti, split = ',')[[1]]
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed=TRUE, value=TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed=TRUE)
temp <- lapply(temp, function(x) gsub("(<[^<>]*>)|(\t)|(\\$)|,",
"", x, perl = TRUE))
rownum<-length(temp)
colnum<-length(temp[[1]])
temp<-matrix(unlist(temp), ncol=rownum)
rownames(temp)<-ti
temp<-temp[c('Owner','Sale Price','Sale Date'),1:min(5,rownum)]
temp <- c(as.vector(temp), rep(NA, (5-rownum)*3))
z[i,] <- temp    # Not right because of the row/pid issue, but....
# End the interesting work.
}
z
files <- dir('samplefiles', full.names = TRUE)
files
?grep
#
# Ownership History
#
# The "frame" of this script is just to test the "body" of the loop -- the
# example problem is getting the most five recent sale information fields.
# So you'd need some minor adaptations to fit the code into your
# scripts (i.e. replace my "frame" with your "frame") but the work
# itself (denoted clearly below) is the interesting part.
files <- dir('samplefiles', full.names = TRUE)
files <- files[grep('[0-9]+.html$', files)]
z <- as.data.frame(matrix(NA, length(files), 15))
names(z) <- paste(rep(c("buyer", "price", "date"), 5), rep(1:5, each=3), sep="")
getctent <- function(x) gsub("(<[^<>]*>)|(\t)|(\\$)|,", "", x, perl = TRUE)
for (i in 1:length(files)) {
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
#Catch the column names
ti <- gsub('<th[^<>]+>', '', trimws(x[start+4]))
ti <- gsub('&amp;', '&', ti)
ti <- gsub('</th>', ',', ti)
ti <- gsub('<br>', ' ', ti)
ti <- strsplit(ti, split = ',')[[1]]
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed = TRUE, value = TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed = TRUE)
temp <- lapply(temp, getctent)
rownum <- length(temp)
temp<-matrix(unlist(temp), ncol = rownum)
rownames(temp)<-ti
temp<-temp[c('Owner','Sale Price','Sale Date'),1:min(5,rownum)]
temp <- c(as.vector(temp), rep(NA, (5-rownum)*3))
z[i,] <- temp    # Not right because of the row/pid issue, but....
# End the interesting work.
}
z
#
# Ownership History
#
# The "frame" of this script is just to test the "body" of the loop -- the
# example problem is getting the most five recent sale information fields.
# So you'd need some minor adaptations to fit the code into your
# scripts (i.e. replace my "frame" with your "frame") but the work
# itself (denoted clearly below) is the interesting part.
files <- dir('samplefiles', full.names = TRUE)
files <- files[grep('[0-9]+.html$', files)]
z <- as.data.frame(matrix(NA, length(files), 15))
names(z) <- paste(rep(c("buyer", "price", "date"), 5), rep(1:5, each=3), sep="")
getctent <- function(x) gsub("(<[^<>]*>)|(\t)|(\\$)|,", "", x, perl = TRUE)
for (i in 1:length(files)) {
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
#Catch the column names
ti <- gsub('<th[^<>]+>', '', trimws(x[start+4]))
ti <- gsub('&amp;', '&', ti)
ti <- gsub('</th>', ',', ti)
ti <- gsub('<br>', ' ', ti)
ti <- strsplit(ti, split = ',')[[1]]
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed = TRUE, value = TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed = TRUE)
temp <- lapply(temp, getctent)
rownum <- length(temp)
temp<-matrix(unlist(temp), ncol = rownum)
rownames(temp)<-ti
temp<-temp[c('Owner', 'Sale Price', 'Sale Date'), 1:min(5,rownum)]
temp <- c(as.vector(temp), rep(NA, (5-rownum)*3))
z[i,] <- temp    # Not right because of the row/pid issue, but....
# End the interesting work.
}
#
# Ownership History
#
# The "frame" of this script is just to test the "body" of the loop -- the
# example problem is getting the most five recent sale information fields.
# So you'd need some minor adaptations to fit the code into your
# scripts (i.e. replace my "frame" with your "frame") but the work
# itself (denoted clearly below) is the interesting part.
files <- dir('samplefiles', full.names = TRUE)
files <- files[grep('[0-9]+.html$', files)]
z <- as.data.frame(matrix(NA, length(files), 15))
names(z) <- paste(rep(c("buyer", "price", "date"), 5), rep(1:5, each=3), sep="")
getctent <- function(x) gsub("(<[^<>]*>)|(\t)|(\\$)|,", "", x, perl = TRUE)
for (i in 1:length(files)) {
file <- files[i]
x <- scan(file, what="", sep="\n", quiet=TRUE)
# Interesting work starts here:
start <- grep("Ownership History", x)[1] + 1
#Catch the column names
ti <- gsub('<th[^<>]+>', '', trimws(x[start+4]))
ti <- gsub('&amp;', '&', ti)
ti <- gsub('</th>', ',', ti)
ti <- gsub('<br>', ' ', ti)
ti <- strsplit(ti, split = ',')[[1]]
temp <- grep("</table>", x)
end <- min(temp[temp > start])
#Trim the whitespace characters
temp <- grep("$", x[start:end], fixed = TRUE, value = TRUE)
temp <- gsub('&amp;', '&', temp)
temp <- strsplit(temp, "</td>", fixed = TRUE)
temp <- lapply(temp, getctent)
rownum <- length(temp)
temp <- matrix(unlist(temp), ncol = rownum)
rownames(temp) <- ti
temp <- temp[c('Owner', 'Sale Price', 'Sale Date'), 1:min(5, rownum)]
temp <- c(as.vector(temp), rep(NA, (5-rownum)*3))
z[i,] <- temp    # Not right because of the row/pid issue, but....
# End the interesting work.
}
write.table(z, file = 'Ownership_dj333.csv', row.names = FALSE, sep= ',')
write.table(z, file = '~/Dropbox/625_dj333/Ownership_dj333.csv', row.names = FALSE, sep= ',')
dir()
dir('samplefiles')
files
pids <- gsub('.+([0-9]+).+', '\\1', files)
pids
pids <- gsub("[^0-9]+([0-9]+).+", '\\1', files)
pids
files <- files[order(as.numeric(pids))]
files
